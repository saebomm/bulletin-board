<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(~{::content})}">
<body>
<section th:fragment="content" class="bb-stack bb-stack--lg">

    <!-- 라벨 맵(한글 표시용) -->
    <th:block th:with="
        statusLabels=${ {'ACTIVE':'활성', 'INACTIVE':'비활성', 'BLOCKED':'차단', 'WITHDRAW':'탈퇴'} }
    ">

        <div class="bb-card bb-card--spaced">

            <!-- 헤더: 타이틀 + 설명 + 우측 필터/액션 -->
            <div class="bb-card__header bb-card__header--split">
                <div>
                    <h1 class="bb-page-title">회원 관리</h1>
                    <p class="bb-page-subtitle">
                        계정 상태 변경은 관리자만 가능합니다.
                    </p>
                </div>

                <div class="bb-actions bb-actions--right bb-admin-actions">
                    <!-- 상태 필터 -->
                    <form th:action="@{/admin/members}" method="get" class="bb-inline bb-inline--tight">
                        <select name="status" class="bb-select bb-select--sm">
                            <option value="">전체 상태</option>
                            <option th:each="s : ${statuses}"
                                    th:block th:if="${s.name() != 'WITHDRAW'}"
                                    th:value="${s}"
                                    th:text="${statusLabels[s.name()]}"
                                    th:selected="${param.status != null and param.status[0] == s.name()}">
                            </option>
                        </select>
                        <button type="submit" class="bb-btn bb-btn--subtle">필터</button>
                    </form>
                </div>
            </div>

            <!-- 테이블 (데스크탑 전용) -->
            <div class="bb-table-wrapper bb-admin-table-desktop">
                <table class="bb-table">
                    <thead>
                    <tr>
                        <th>번호</th>
                        <th>아이디</th>
                        <th>이름</th>
                        <th>가입일</th>
                        <th class="bb-col-role">권한</th>
                        <th class="bb-col-status">상태</th>
                        <th class="bb-col-action">변경</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr th:if="${#lists.isEmpty(members)}">
                        <td colspan="8" class="bb-table-empty">
                            조회된 회원이 없습니다.
                        </td>
                    </tr>

                    <tr th:each="m, stat : ${members}">
                        <td th:text="${#lists.size(members) - stat.index}">1</td>

                        <td>
                            <div class="bb-admin-user">
                                <a th:href="@{|/admin/members/${m.id}|}"
                                   class="bb-admin-username-link"
                                   th:text="${m.username}">
                                    아이디
                                </a>
                            </div>
                        </td>

                        <td th:text="${m.name}">이름</td>

                        <td class="bb-col-email" th:text="${#temporals.format(m.createdAt, 'yyyy-MM-dd')}">2025-01-01</td>

                        <td class="bb-col-role">
                            <span class="bb-role-badge"
                                  th:classappend="${m.admin} ? ' bb-role-badge--admin' : ''"
                                  th:text="${m.roleText}">
                            </span>
                        </td>

                        <td class="bb-col-status">
                            <select name="status"
                                    class="bb-select bb-select--sm"
                                    th:form="|statusForm__${m.id}|">
                                <option th:each="s : ${statuses}"
                                        th:block th:if="${s.name() != 'WITHDRAW'}"
                                        th:value="${s}"
                                        th:text="${statusLabels[s.name()]}"
                                        th:selected="${s == m.status}">
                                </option>
                            </select>
                        </td>

                        <td class="bb-col-action">
                            <form th:id="|statusForm__${m.id}|"
                                  th:action="@{|/admin/members/${m.id}/status|}"
                                  method="post"
                                  class="bb-inline bb-inline--tight">
                                <button type="submit" class="bb-btn bb-btn--primary bb-btn--sm">
                                    적용
                                </button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- 모바일 카드 리스트 -->
            <div class="bb-admin-list-mobile">

                <p class="bb-table-empty" th:if="${#lists.isEmpty(members)}">
                    조회된 회원이 없습니다.
                </p>

                <ul class="bb-admin-card-list"
                    th:if="${!#lists.isEmpty(members)}">

                    <li th:each="m : ${members}" class="bb-admin-card">

                        <!-- 카드 정보 영역만 링크 -->
                        <a th:href="@{|/admin/members/${m.id}|}"
                           class="bb-admin-card-link">

                            <!-- 상단: 이름 + 권한 뱃지 -->
                            <div class="bb-admin-card__top">
                                <div class="bb-admin-card__name-group">
                                    <span class="bb-admin-card__name" th:text="${m.name}">이름</span>

                                    <span class="bb-role-badge"
                                          th:classappend="${m.admin} ? ' bb-role-badge--admin' : ''"
                                          th:text="${m.roleText}">
                                        권한
                                    </span>
                                </div>
                            </div>

                            <!-- 중단: 아이디 + 가입일 -->
                            <div class="bb-admin-card__meta">
                                <span class="bb-admin-card__username"
                                      th:text="'@' + ${m.username}">
                                    @아이디
                                </span>

                                <span class="bb-admin-card__dot">·</span>

                                <span class="bb-admin-card__date"
                                      th:text="'가입일: ' + ${#temporals.format(m.createdAt, 'yyyy-MM-dd')}">
                                    가입일: 2025-01-01
                                </span>
                            </div>
                        </a>

                        <!-- 상태 변경 폼은 링크 밖 (클릭/submit 안전) -->
                        <form th:action="@{|/admin/members/${m.id}/status|}"
                              method="post"
                              class="bb-admin-card__actions">

                            <select name="status" class="bb-select bb-select--sm bb-select--block">
                                <option th:each="s : ${statuses}"
                                        th:block th:if="${s.name() != 'WITHDRAW'}"
                                        th:value="${s}"
                                        th:text="${statusLabels[s.name()]}"
                                        th:selected="${s == m.status}">
                                </option>
                            </select>

                            <button type="submit"
                                    class="bb-btn bb-btn--primary bb-btn--block">
                                적용
                            </button>
                        </form>

                    </li>
                </ul>
            </div>

            <p class="bb-form-hint" style="margin-top: 10px;">
                * 상태 변경은 즉시 반영됩니다.
            </p>

        </div>

    </th:block>

</section>
</body>
</html>